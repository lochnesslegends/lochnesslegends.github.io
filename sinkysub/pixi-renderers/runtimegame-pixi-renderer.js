var gdjs;(function(l){const h=new l.Logger("PIXI game renderer"),d=GlobalPIXIModule.PIXI,f=[37,38,39,40];class g{constructor(n,t){this._isFullPage=!0;this._isFullscreen=!1;this._pixiRenderer=null;this._canvasWidth=0;this._canvasHeight=0;this._keepRatio=!0;this._nextFrameId=0;this._game=n,this._forceFullscreen=t,this._marginLeft=this._marginTop=this._marginRight=this._marginBottom=0,this._setupOrientation()}createStandardCanvas(n){this._pixiRenderer=d.autoDetectRenderer({width:this._game.getGameResolutionWidth(),height:this._game.getGameResolutionHeight(),preserveDrawingBuffer:!0,antialias:!1}),n.appendChild(this._pixiRenderer.view),this._pixiRenderer.view.style.position="absolute",this._pixiRenderer.view.tabIndex=1,this._resizeCanvas(),this._game.getScaleMode()==="nearest"&&(this._pixiRenderer.view.style["image-rendering"]="-moz-crisp-edges",this._pixiRenderer.view.style["image-rendering"]="-webkit-optimize-contrast",this._pixiRenderer.view.style["image-rendering"]="-webkit-crisp-edges",this._pixiRenderer.view.style["image-rendering"]="pixelated"),this._game.getPixelsRounding()&&(d.settings.ROUND_PIXELS=!0);const t=this;return window.addEventListener("resize",function(){t._game.onWindowInnerSizeChanged(),t._resizeCanvas(),t._game._notifySceneForResize=!0}),this._pixiRenderer}static getWindowInnerWidth(){return typeof window!="undefined"?window.innerWidth:800}static getWindowInnerHeight(){return typeof window!="undefined"?window.innerHeight:800}updateRendererSize(){this._resizeCanvas()}_setupOrientation(){if(typeof window=="undefined"||!window.screen||!window.screen.orientation)return;const n=this._game.getGameData().properties.orientation;try{if(n==="default"){const t=window.screen.orientation.unlock();t&&t.catch(()=>{})}else window.screen.orientation.lock(n).catch(()=>{})}catch(t){h.error("Unexpected error while setting up orientation: ",t)}}_resizeCanvas(){if(!this._pixiRenderer)return;(this._pixiRenderer.width!==this._game.getGameResolutionWidth()||this._pixiRenderer.height!==this._game.getGameResolutionHeight())&&this._pixiRenderer.resize(this._game.getGameResolutionWidth(),this._game.getGameResolutionHeight());const n=this._forceFullscreen||this._isFullPage||this._isFullscreen;let t=this._game.getGameResolutionWidth(),i=this._game.getGameResolutionHeight(),r=window.innerWidth-this._marginLeft-this._marginRight,s=window.innerHeight-this._marginTop-this._marginBottom;if(r<0&&(r=0),s<0&&(s=0),n&&!this._keepRatio)t=r,i=s;else if(n&&this._keepRatio||t>r||i>s){let a=r/t;i*a>s&&(a=s/i),t*=a,i*=a}this._pixiRenderer.view.style.top=this._marginTop+(s-i)/2+"px",this._pixiRenderer.view.style.left=this._marginLeft+(r-t)/2+"px",this._pixiRenderer.view.style.width=t+"px",this._pixiRenderer.view.style.height=i+"px",this._canvasWidth=t,this._canvasHeight=i}keepAspectRatio(n){this._keepRatio!==n&&(this._keepRatio=n,this._resizeCanvas(),this._game._notifySceneForResize=!0)}setMargins(n,t,i,r){this._marginTop===n&&this._marginRight===t&&this._marginBottom===i&&this._marginLeft===r||(this._marginTop=n,this._marginRight=t,this._marginBottom=i,this._marginLeft=r,this._resizeCanvas(),this._game._notifySceneForResize=!0)}setWindowSize(n,t){const i=this.getElectron();if(i){const r=i.remote.getCurrentWindow();r&&r.setContentSize(n,t)}else h.warn("Window size can't be changed on this platform.")}centerWindow(){const n=this.getElectron();if(n){const t=n.remote.getCurrentWindow();t&&t.center()}}setFullScreen(n){if(!this._forceFullscreen&&this._isFullscreen!==n){this._isFullscreen=!!n;const t=this.getElectron();if(t){const i=t.remote.getCurrentWindow();i&&i.setFullScreen(this._isFullscreen)}else this._isFullscreen?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen();this._resizeCanvas(),this._notifySceneForResize=!0}}isFullScreen(){const n=this.getElectron();return n?n.remote.getCurrentWindow().isFullScreen():this._isFullscreen||window.screen.height===window.innerHeight}bindStandardEvents(n,t,i){const r=this._pixiRenderer;if(!r)return;const s=r.view,a=this;function u(e){const o=[0,0];return e.pageX?(o[0]=e.pageX-s.offsetLeft,o[1]=e.pageY-s.offsetTop):(o[0]=e.clientX+i.body.scrollLeft+i.documentElement.scrollLeft-s.offsetLeft,o[1]=e.clientY+i.body.scrollTop+i.documentElement.scrollTop-s.offsetTop),o[0]*=a._game.getGameResolutionWidth()/(a._canvasWidth||1),o[1]*=a._game.getGameResolutionHeight()/(a._canvasHeight||1),o}(function(){isNaN(s.offsetLeft)&&(s.offsetLeft=0,s.offsetTop=0),isNaN(i.body.scrollLeft)&&(i.body.scrollLeft=0,i.body.scrollTop=0),(i.documentElement===void 0||i.documentElement===null)&&(i.documentElement={}),isNaN(i.documentElement.scrollLeft)&&(i.documentElement.scrollLeft=0,i.documentElement.scrollTop=0),isNaN(s.offsetLeft)&&(s.offsetLeft=0,s.offsetTop=0)})(),i.onkeydown=function(e){f.includes(e.keyCode)&&e.preventDefault(),n.onKeyPressed(e.keyCode,e.location)},i.onkeyup=function(e){f.includes(e.keyCode)&&e.preventDefault(),n.onKeyReleased(e.keyCode,e.location)},r.view.onmousemove=function(e){const o=u(e);n.onMouseMove(o[0],o[1])},r.view.onmousedown=function(e){return n.onMouseButtonPressed(e.button===2?l.InputManager.MOUSE_RIGHT_BUTTON:e.button===1?l.InputManager.MOUSE_MIDDLE_BUTTON:l.InputManager.MOUSE_LEFT_BUTTON),t.focus!==void 0&&t.focus(),!1},r.view.onmouseup=function(e){return n.onMouseButtonReleased(e.button===2?l.InputManager.MOUSE_RIGHT_BUTTON:e.button===1?l.InputManager.MOUSE_MIDDLE_BUTTON:l.InputManager.MOUSE_LEFT_BUTTON),!1},t.addEventListener("click",function(e){return t.focus!==void 0&&t.focus(),e.preventDefault(),!1},!1),r.view.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},r.view.onwheel=function(e){n.onMouseWheel(-e.deltaY)},t.addEventListener("touchmove",function(e){if(e.preventDefault(),e.changedTouches)for(let o=0;o<e.changedTouches.length;++o){const c=u(e.changedTouches[o]);n.onTouchMove(e.changedTouches[o].identifier,c[0],c[1])}}),t.addEventListener("touchstart",function(e){if(e.preventDefault(),e.changedTouches)for(let o=0;o<e.changedTouches.length;++o){const c=u(e.changedTouches[o]);n.onTouchStart(e.changedTouches[o].identifier,c[0],c[1])}return!1}),t.addEventListener("touchend",function(e){if(e.preventDefault(),e.changedTouches)for(let o=0;o<e.changedTouches.length;++o){const c=u(e.changedTouches[o]);n.onTouchEnd(e.changedTouches[o].identifier)}return!1})}setWindowTitle(n){typeof document!="undefined"&&(document.title=n)}getWindowTitle(){return typeof document!="undefined"?document.title:""}startGameLoop(n){let t=0;const i=r=>{this._nextFrameId=requestAnimationFrame(i);const s=t?r-t:0;t=r,n(s)||cancelAnimationFrame(this._nextFrameId)};requestAnimationFrame(i)}getPIXIRenderer(){return this._pixiRenderer}openURL(n){if(typeof window!="undefined"){const t=this.getElectron();if(t)t.shell.openExternal(n);else{const i=window.cordova?"_system":"_blank";window.open(n,i)}}}stopGame(){const n=this.getElectron();if(n){const t=n.remote.getCurrentWindow();t&&t.close()}else typeof navigator!="undefined"&&navigator.app&&navigator.app.exitApp&&navigator.app.exitApp()}getCanvas(){return this._pixiRenderer.view}isWebGLSupported(){return!!this._pixiRenderer&&this._pixiRenderer.type===d.RENDERER_TYPE.WEBGL}getElectron(){return typeof require!="undefined"?require("electron"):null}}l.RuntimeGamePixiRenderer=g,l.RuntimeGameRenderer=g})(gdjs||(gdjs={}));
//# sourceMappingURL=runtimegame-pixi-renderer.js.map
