var gdjs;(function(f){const b=GlobalPIXIModule.PIXI;class m{constructor(n,d){this._debugDraw=null;this._debugDrawContainer=null;this._profilerText=null;this._pixiRenderer=d?d.getPIXIRenderer():null,this._runtimeScene=n,this._pixiContainer=new b.Container,this._debugDrawRenderedObjectsPoints={},this._pixiContainer.sortableChildren=!0,this._debugDraw=null}onGameResolutionResized(){if(!this._pixiRenderer)return;const n=this._runtimeScene.getGame();this._pixiContainer.scale.x=this._pixiRenderer.width/n.getGameResolutionWidth(),this._pixiContainer.scale.y=this._pixiRenderer.height/n.getGameResolutionHeight()}onSceneUnloaded(){}render(){!this._pixiRenderer||(this._pixiRenderer.backgroundColor=this._runtimeScene.getBackgroundColor(),this._pixiRenderer.render(this._pixiContainer))}_renderProfileText(){const n=this._runtimeScene.getProfiler();if(!n)return;this._profilerText||(this._profilerText=new b.Text(" ",{align:"left",stroke:"#FFF",strokeThickness:1}),this._pixiContainer.addChild(this._profilerText));const d=n.getFramesAverageMeasures(),l=[];f.Profiler.getProfilerSectionTexts("All",d,l),this._profilerText.text=l.join(`
`)}renderDebugDraw(n,d,l,c,C){(!this._debugDraw||!this._debugDrawContainer)&&(this._debugDrawContainer=new b.Container,this._debugDraw=new b.Graphics,this._debugDrawContainer.addChild(this._debugDraw),this._pixiContainer.addChild(this._debugDrawContainer));const t=this._debugDraw;for(let r in this._debugDrawRenderedObjectsPoints)this._debugDrawRenderedObjectsPoints[r].wasRendered=!1;const p=(r,e,i,u,o)=>{t.line.color=i,t.fill.color=i,t.drawCircle(u,o,3),c&&(r[e]||(r[e]=new b.Text(e,{fill:i,fontSize:12}),this._debugDrawContainer.addChild(r[e])),r[e].position.set(u,o))};t.clear(),t.beginFill(),t.alpha=.8,t.lineStyle(2,255,1);for(let r=0;r<n.length;r++){const e=n[r],i=this._runtimeScene.getLayer(e.getLayer());if((!e.isVisible()||!i.isVisible())&&!l||!e.getRendererObject())continue;const o=e.getAABB();t.fill.alpha=.2,t.line.color=7835368,t.fill.color=7835368;const s=[];s.push.apply(s,i.convertInverseCoords(o.min[0],o.min[1])),s.push.apply(s,i.convertInverseCoords(o.max[0],o.min[1])),s.push.apply(s,i.convertInverseCoords(o.max[0],o.max[1])),s.push.apply(s,i.convertInverseCoords(o.min[0],o.max[1])),t.drawPolygon(s)}for(let r=0;r<n.length;r++){const e=n[r],i=this._runtimeScene.getLayer(e.getLayer());if((!e.isVisible()||!i.isVisible())&&!l||!e.getRendererObject())continue;const o=e.id;this._debugDrawRenderedObjectsPoints[o]||(this._debugDrawRenderedObjectsPoints[o]={wasRendered:!0,points:{}});const s=this._debugDrawRenderedObjectsPoints[o];s.wasRendered=!0;const x=e.getHitBoxes();for(let g=0;g<x.length;g++){const a=[];x[g].vertices.forEach(_=>{_=i.convertInverseCoords(_[0],_[1]),a.push(_[0]),a.push(_[1])}),t.fill.alpha=0,t.line.alpha=.5,t.line.color=16711680,t.drawPolygon(a)}t.fill.alpha=.3;const w=e.getDrawableX()+e.getCenterX(),P=e.getDrawableY()+e.getCenterY(),R=i.convertInverseCoords(w,P);p(s.points,"Center",16776960,R[0],R[1]);let h=[e.getDrawableX(),e.getDrawableY()];if(e instanceof f.SpriteRuntimeObject&&(h=e.getPointPosition("origin")),h=i.convertInverseCoords(h[0],h[1]),p(s.points,"Origin",16711680,h[0],h[1]),C&&e instanceof f.SpriteRuntimeObject){if(!e._animationFrame)continue;for(const g in e._animationFrame.points.items){let a=e.getPointPosition(g);a=i.convertInverseCoords(a[0],a[1]),p(s.points,g,255,a[0],a[1])}}}for(const r in this._debugDrawRenderedObjectsPoints){const e=this._debugDrawRenderedObjectsPoints[r];if(e.wasRendered)continue;const i=e.points;for(const u in i)this._debugDrawContainer.removeChild(i[u])}t.endFill()}clearDebugDraw(){this._debugDraw&&this._debugDraw.clear(),this._debugDrawContainer&&(this._debugDrawContainer.destroy({children:!0}),this._pixiContainer.removeChild(this._debugDrawContainer)),this._debugDraw=null,this._debugDrawContainer=null,this._debugDrawRenderedObjectsPoints={}}hideCursor(){!this._pixiRenderer||(this._pixiRenderer.view.style.cursor="none")}showCursor(){!this._pixiRenderer||(this._pixiRenderer.view.style.cursor="")}getPIXIContainer(){return this._pixiContainer}getPIXIRenderer(){return this._pixiRenderer}setLayerIndex(n,d){const l=n.getRenderer();let c=l.getRendererObject();n.isLightingLayer()&&(c=l.getLightingSprite()),!!c&&this._pixiContainer.children.indexOf(c)!==d&&(this._pixiContainer.removeChild(c),this._pixiContainer.addChildAt(c,d))}}f.RuntimeScenePixiRenderer=m,f.RuntimeSceneRenderer=f.RuntimeScenePixiRenderer})(gdjs||(gdjs={}));
//# sourceMappingURL=runtimescene-pixi-renderer.js.map
